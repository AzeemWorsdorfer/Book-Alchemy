<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Library Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body>
    <h1>Book Alchemy Library</h1>

    {% with messages = get_flashed_messages() %} 
    {% if messages %}
    <!-- Apply the 'flashes' class here -->
    <ul class="flashes">
      {% for message in messages %}
      <li>{{ message }}</li>
      {% endfor %}
    </ul>
    {% endif %} 
    {% endwith %}

    <!-- Apply the 'search-message' class here -->
    {% if search_message %}
    <p class="search-message">{{ search_message }}</p>
    {% endif %}

    <p>
      <a href="{{ url_for('add_author') }}">Add Author</a> |
      <a href="{{ url_for('add_book') }}">Add Book</a>
    </p>

    <h3>
      Sort By: <a href="{{ url_for('home', sort='title') }}">Title</a> |
      <a href="{{ url_for('home', sort='author') }}">Author Name</a>
    </h3>

    <form action="{{ url_for('home') }}" method="GET" style="padding: 15px;">
      <label for="search_term" style="display: inline;">Search Books:</label>
      <input
        type="text"
        id="search_term"
        name="search_term"
        placeholder="Enter title or ISBN"
        style="width: auto; display: inline-block; margin-right: 10px;"
      />
      <input type="submit" value="Search" />
    </form>

    <hr />

    {% for book in books %}
    <!-- Apply the 'book-entry' class and remove inline style -->
    <div class="book-entry">
      <h3>{{ book.title }}</h3>
      <p>
        <strong>Author:</strong> {{ book.author.name }}
        
        <!-- Deletion Form for the Author -->
        <form
          action="{{ url_for('delete_author', author_id=book.author.id) }}"
          method="POST"
          style="display: inline;"
        >
          <!-- Apply the 'delete-button' class -->
          <input
            type="submit"
            value="Delete Author"
            class="delete-button"
            onclick="return confirm('WARNING: Are you sure you want to delete the author {{ book.author.name }} and ALL their books?');"
          />
        </form>
        
        <br />
        <strong>ISBN:</strong> {{ book.isbn }}<br />
      </p>

      <!-- Deletion Form for the Book -->
      <form
        action="{{ url_for('delete_book', book_id=book.id) }}"
        method="POST"
        style="display: inline"
      >
        <!-- Apply the 'delete-button' class -->
        <input
          type="submit"
          value="Delete Book"
          class="delete-button"
          onclick="return confirm('Are you sure you want to delete {{ book.title }}?');"
        />
      </form>
    </div>
    {% endfor %}
  </body>
</html>